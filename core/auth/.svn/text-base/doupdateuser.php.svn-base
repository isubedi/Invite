<?php
	include_once("../../includes/db.php");
	include_once("../db_func/secure.php");
	
	makeSureAuthenticated();
	
	$password = md5(clean($_POST['password']));
	$username = clean($_POST['username']);
	$email = clean($_POST['email']);
	$location = clean($_POST['location']);	
	$phone = clean($_POST['phone']);
	$userId = getUserId();
	$name = clean($_POST['name']);
	$date = clean($_POST['birthdate']);
	$gender = clean($_POST['gender']);
	$err_code = 0;
	
	if (empty($password)) {
		$err_code = 1000;
	}
	
	if (empty($username)) {
		$err_code = 1007;		
	}
	
	if (empty($email)) {
		$err_code = 1001;		
	}
	
	if (empty($location)) {
		$err_code = 1000;		
	}
	
	if (empty($name)) {
		$err_code = 1000;
	}
	
	if (empty($date)) {
		$err_code = 1000;		
	}	

	if (empty($gender)) {
		$err_code = 1000;		
	}	
	
	if ($err_code != 0) {
		header( "Location: ".$WEB_ROOT."editprofile/".$err_code) ;
		exit;		
	}
	
	$date = str_replace("-", "/", $date);
	mysql_query("UPDATE users set username = '$username', name = '$name', email = '$email', phoneNo = $phone, location = '$location', gender = '$gender', birthdate = STR_TO_DATE('$date', '%Y/%m/%d') where id ='$userId'") or die(	header( "Location: ".$WEB_ROOT."editprofile/0000"));

	header( "Location: ".$WEB_ROOT."editprofile/0") ;
	exit;

?>